<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeppe Girls Matric Dance - MD Portal</title>
  
<style>
:root {
  --brand-gold: #bfa34d;
  --brand-gold-light: #e6d16b;
  --ink: #222;
  --bg-card: #fff;
  --bg-soft: #fafafa;
  --floor: #000;
  --shadow: 0 2px 10px rgba(0,0,0,.08);
  --shadow-strong: 0 6px 24px rgba(0,0,0,.15);
  --radius: 12px;
  --radius-lg: 18px;
  --focus: 0 0 0 3px rgba(191,163,77,.25);
}

html, body {
  margin: 0;
  padding: 0;
  min-height: 100%;
  font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background: #fff;
  color: var(--ink);
  display: flex;
  justify-content: center;
  padding: 16px;
  box-sizing: border-box;
}

.app {
  width: 100%;
  max-width: 1100px;
  background: #fff;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-strong);
  overflow: hidden;
  border: 1px solid #eee;
}

/* Header */
.header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
  background: #fff;
  border-bottom: 1px solid #eee;
  padding: 18px;
}
.header__brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.header__logo {
  width: 64px;
  height: 64px;
  object-fit: contain;
}
.header__title {
  font-size: clamp(20px, 3vw, 32px);
  font-weight: 700;
  color: var(--ink);
  margin: 0;
}

/* Countdown */
.countdown {
  text-align: center;
  padding: 12px;
  font-size: clamp(18px, 2.4vw, 26px);
  font-weight: 600;
  color: var(--ink);
}

/* Steps */
.steps {
  padding: 20px;
  background: var(--bg-soft);
  display: grid;
  gap: 20px;
}
.step {
  display: none;
  background: var(--bg-card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 24px;
}
.step.active { display: block; }
.step h2 {
  text-align: center;
  font-size: clamp(18px, 2.2vw, 26px);
  margin: 0 0 12px;
  color: var(--brand-gold);
}

/* Controls */
.controls {
  display: grid;
  gap: 12px;
  margin: 12px auto;
  width: min(95%, 500px);
}
.control {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 16px;
  padding: 12px 14px;
  outline: none;
  transition: box-shadow .2s ease, border-color .2s ease;
  background: #fff;
}
.control:focus {
  border-color: var(--brand-gold);
  box-shadow: var(--focus);
}

/* Captions */
.caption {
  text-align: center;
  font-size: 14px;
  color: #666;
  margin: 8px 0 14px;
  font-style: italic;
}

/* Buttons */
.buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-top: 16px;
}
.btn {
  background: var(--brand-gold);
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
  transition: all .2s ease;
}
.btn:hover { background: var(--brand-gold-light); color: #000; }

/* Floor Plan */
.floor {
  position: relative;
  width: 100%;
  min-height: 70vh;
  overflow: auto;
  margin: 0 auto;
  background: #fafafa;
  border-radius: var(--radius);
  border: 1px solid #eee;
}
.table {
  position: absolute;
  background: var(--brand-gold-light);
  border-radius: 50%;
  width: 80px;
  height: 80px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-weight: bold;
  color: #333;
  transition: transform .15s ease, box-shadow .2s ease;
  box-shadow: var(--shadow);
}
.table.square {
  border-radius: 10px;
  width: 100px;
  height: 100px;
  background: var(--brand-gold);
  color: #fff;
}
.table__label {
  width: 100%;
  text-align: center;
  font-weight: 700;
  font-size: 12px;
  pointer-events: none;
}
.seat {
  width: 18px;
  height: 18px;
  background: #fff;
  border: 1px solid var(--brand-gold);
  border-radius: 50%;
  margin: 2px;
  cursor: pointer;
  transition: transform .05s ease, background .2s ease, box-shadow .15s ease;
}
.seat:hover { transform: scale(1.1); }
.seat.selected { background: var(--brand-gold); box-shadow: inset 0 0 0 2px #fff; }
.seat.booked { background: #ccc; pointer-events: none; cursor: not-allowed; }

/* Dancefloor */
.dancefloor {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 2vw;
  color: #333;
  border: 2px dashed var(--brand-gold);
  border-radius: 8px;
  background: #f7f7f7;
}

/* Confirmation */
#confirmation {
  background: var(--bg-soft);
  border: 1px solid #eee;
  padding: 16px;
  border-radius: 10px;
  line-height: 1.5;
  color: #333;
  width: min(95%, 600px);
  margin: 0 auto;
}

/* Contact */
#contact {
  text-align: center;
  margin: 10px 0 24px;
  font-size: 14px;
  color: #555;
  font-style: italic;
}

/* Slider */
.slider {
  width: min(960px, 95%);
  margin: 20px auto;
  overflow: hidden;
  border-radius: var(--radius);
  box-shadow: var(--shadow-strong);
}
.slides {
  display: flex;
  width: 100%;
  animation: slide 35s infinite;
}
.slides img {
  width: 100%;
  object-fit: cover;
  aspect-ratio: 16/9;
}

@keyframes slide {
  0%,18% {transform: translateX(0);}
  20%,38% {transform: translateX(-100%);}
  40%,58% {transform: translateX(-200%);}
  60%,78% {transform: translateX(-300%);}
  80%,98% {transform: translateX(-400%);}
  100% {transform: translateX(0);}
}

/* Responsive */
@media(max-width:768px){
  .header__logo{width:50px;height:50px;}
  .floor{min-height:60vh;}
}
</style>


</head>
<body>

<div class="app" role="application" aria-label="Matric Dance Portal">
  <header class="header" role="banner">
    <div class="header__brand" aria-label="Jeppe Girls Matric Dance">
      <img class="header__logo" src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/download-removebg-preview.png" alt="Jeppe Girls badge" />
      <h1 class="header__title">Jeppe Girls Matric Dance Portal</h1>
    </div>
  </header>

  <section id="countdown" class="countdown" role="status" aria-live="polite">
    <div class="countdown__text">Loading countdown‚Ä¶</div>
  </section>

  <main class="steps" role="main">
    <form id="mdForm" method="POST" action="https://script.google.com/macros/s/AKfycbwkBaCd1uMupQGGxCTH0obyx9BHMePYvBFEobsMqb2Z38eNMoy4Mn_8qn36jQfp6SPQ5w/exec">
      <input type="hidden" name="payload" id="payloadInput" />

      <!-- Step 0: Welcome -->
      <section class="step active" id="step0">
        <h2>Welcome to the Matric Dance Portal</h2>
        <p class="caption">Please enter your details to get started.</p>
        <div class="controls">
          <input class="control" type="text" id="firstName" placeholder="First Name" autocomplete="given-name" />
          <input class="control" type="text" id="lastName" placeholder="Last Name" autocomplete="family-name" />
          <select class="control" id="classSelect">
            <option value="">Select your class</option>
            <option value="12E">12 E</option>
            <option value="12D">12 D</option>
            <option value="12U">12 U</option>
            <option value="12C">12 C</option>
            <option value="12A">12 A</option>
            <option value="12T">12 T</option>
          </select>
        </div>
        <div class="buttons"><button class="btn" type="button" onclick="nextStep()">Next</button></div>
      </section>

      <!-- Step 1: Upload Proof -->
      <section class="step" id="step1">
        <h2>Step 1: Upload Proof of Payment</h2>
        <div class="controls">
          <input class="control" type="file" id="paymentProof" accept="image/*,application/pdf" />
        </div>
        <p class="caption">Theme: <strong>The Great Gatsby</strong> ‚Äì dress to dazzle! üì∏</p>
        <div class="buttons">
          <button class="btn" type="button" onclick="prevStep()">Back</button>
          <button class="btn" type="button" onclick="nextStep()">Next</button>
        </div>
      </section>

      <!-- Step 2: Table & Seats -->
      <section class="step" id="step2">
        <h2>Step 2: Choose Your Table & Seats</h2>
        <div id="floorPlan" class="floor"></div>
        <p class="caption">Click a table to select it, then pick your seat(s). Max 2 seats per booking. üéâ</p>
        <div class="buttons">
          <button class="btn" type="button" onclick="prevStep()">Back</button>
          <button class="btn" type="button" onclick="nextStep()">Next</button>
        </div>
      </section>

      <!-- Step 3: Dietary -->
      <section class="step" id="step3">
        <h2>Step 3: Dietary Requirements</h2>
        <div class="controls">
          <textarea class="control" id="dietary" rows="4" placeholder="Enter dietary requirements‚Ä¶"></textarea>
        </div>
        <p class="caption">We‚Äôll do our best to accommodate you. üçΩÔ∏è</p>
        <div class="buttons">
          <button class="btn" type="button" onclick="prevStep()">Back</button>
          <button class="btn" type="button" onclick="nextStep()">Next</button>
        </div>
      </section>

      <!-- Step 4: Music -->
      <section class="step" id="step4">
        <h2>Step 4: Music Choices</h2>
        <div class="controls">
          <textarea class="control" id="music" rows="4" placeholder="Enter music choices‚Ä¶"></textarea>
        </div>
        <p class="caption">Let‚Äôs make your night unforgettable! üé∂</p>
        <div class="buttons">
          <button class="btn" type="button" onclick="prevStep()">Back</button>
          <button class="btn" type="button" onclick="nextStep()">Next</button>
        </div>
      </section>

      <!-- Step 5: Confirmation -->
      <section class="step" id="step5">
        <h2>Step 5: Confirm Your Details</h2>
        <div id="confirmation"></div>
        <div class="buttons">
          <button class="btn" type="button" onclick="prevStep()">Back</button>
          <button class="btn" type="submit">Submit</button>
        </div>
      </section>

      <!-- Step 6: Thank You -->
      <section class="step" id="step6">
        <h2>Thank You!</h2>
        <p class="caption">Your submission has been received. We can‚Äôt wait to see you at the Matric Dance! üéâ</p>
      </section>
    </form>
  </main>

  <p id="contact">For assistance, contact us at <strong>mjarvis@jeppegirls.co.za</strong></p>

  <section class="slider" aria-label="Matric dance gallery">
    <div class="slides">
      <img src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/Screenshot%20(441).png" alt="Dance Photo 1" />
      <img src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/Screenshot%20(440).png" alt="Dance Photo 2" />
      <img src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/Screenshot%20(442).png" alt="Dance Photo 3" />
      <img src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/Matric-Dance-FS-Rebecca-Mortley.jpg" alt="Dance Photo 4" />
      <img src="https://uploads.onecompiler.io/434dtae6m/43ubv7akb/GG06892rc_a_l.webp" alt="Dance Photo 5"/>
    </div>
  </section>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwkBaCd1uMupQGGxCTH0obyx9BHMePYvBFEobsMqb2Z38eNMoy4Mn_8qn36jQfp6SPQ5w/exec';
let currentStep = 0;
let selectedTable = null;
const totalSteps = 6;

// ---------------- Seat Helpers ----------------
function seatKey(tid, sno) { return `${tid}-${sno}`; }

// Always fetch booked seats from server
async function fetchBookedSeats() {
  try {
    const res = await fetch(`${SCRIPT_URL}?action=getBookedSeats`);
    const data = await res.json(); // expects ["1-1","2-3",...]
    return data;
  } catch (err) {
    console.warn('Failed to fetch booked seats:', err);
    return [];
  }
}

// Update seat classes based on booked set
function markBookedSeats(bookedSet) {
  document.querySelectorAll('.seat').forEach(seat => {
    const key = seatKey(seat.closest('.table').dataset.id, seat.dataset.seatNumber);
    if (bookedSet.includes(key)) {
      seat.classList.add('booked');
      seat.classList.remove('selected');
    } else {
      seat.classList.remove('booked');
    }
  });
}

// ---------------- Countdown ----------------
(function initCountdown() {
  const el = document.querySelector('.countdown__text');
  const eventDate = new Date(2025, 8, 27, 19, 0, 0);
  function tick() {
    const diff = eventDate - new Date();
    if (diff <= 0) { el.textContent = 'üéâ The Matric Dance has started! üéâ'; return; }
    const days = Math.floor(diff / 86400000);
    const hours = Math.floor((diff / 3600000) % 24);
    const minutes = Math.floor((diff / 60000) % 60);
    const seconds = Math.floor((diff / 1000) % 60);
    el.textContent = `Matric Dance in: ${days}d ${hours}h ${minutes}m ${seconds}s ‚è∞`;
  }
  tick(); setInterval(tick, 1000);
})();

// ---------------- Steps ----------------
function showStep(i) {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById(`step${i}`).classList.add('active');
  currentStep = i;
  if (i === 5) showConfirmation();
}
function nextStep() {
  if (currentStep === 0) {
    const f = document.getElementById('firstName').value.trim();
    const l = document.getElementById('lastName').value.trim();
    const c = document.getElementById('classSelect').value;
    if (!f || !l || !c) { alert('Please fill in your name, surname, and class.'); return; }
  }
  if (currentStep === 2) {
    if (!selectedTable) { alert('Please select a table before continuing.'); return; }
    const t = document.querySelector(`.table[data-id="${selectedTable}"]`);
    const seats = [...t.querySelectorAll('.seat.selected')];
    if (seats.length < 1) { alert('Please select at least 1 seat.'); return; }
    showConfirmation();
  }
  showStep(Math.min(currentStep + 1, totalSteps));
}
function prevStep() { showStep(Math.max(currentStep - 1, 0)); }
window.nextStep = nextStep; window.prevStep = prevStep;

// ---------------- Floor & Seats ----------------
const floor = document.getElementById('floorPlan');
const tableData = [
  {id:1,type:'square',seats:12,top:50,left:50},
  {id:'danceFloor',type:'rectangle',label:'DANCE FLOOR',top:50,left:220,width:520,height:210},
  {id:23,type:'square',seats:12,top:50,left:780},
  {id:2,type:'round',seats:10,top:200,left:50},
  {id:22,type:'round',seats:10,top:200,left:780},
  {id:3,type:'square',seats:12,top:350,left:50},
  {id:4,type:'round',seats:10,top:300,left:170},
  {id:5,type:'square',seats:12,top:300,left:260},
  {id:19,type:'square',seats:12,top:300,left:400},
  {id:12,type:'round',seats:10,top:300,left:560},
  {id:20,type:'round',seats:10,top:300,left:670},
  {id:21,type:'square',seats:12,top:350,left:780},
  {id:7,type:'square',seats:12,top:500,left:50},
  {id:6,type:'round',seats:10,top:470,left:170},
  {id:9,type:'round',seats:10,top:500,left:260},
  {id:11,type:'square',seats:12,top:450,left:360},
  {id:13,type:'square',seats:12,top:450,left:510},
  {id:15,type:'round',seats:10,top:450,left:650},
  {id:18,type:'round',seats:10,top:450,left:650},
  {id:17,type:'square',seats:12,top:500,left:780},
  {id:8,type:'round',seats:10,top:650,left:50},
  {id:10,type:'square',seats:12,top:650,left:320},
  {id:14,type:'round',seats:10,top:650,left:560},
  {id:16,type:'square',seats:12,top:650,left:720}
];

function buildFloor(bookedFromSheet=[]) {
  floor.innerHTML = '';
  tableData.forEach(t => {
    if (t.type === 'rectangle') {
      const d = document.createElement('div');
      d.className = 'dancefloor';
      d.style.top = t.top+'px'; d.style.left = t.left+'px';
      d.style.width = t.width+'px'; d.style.height = t.height+'px';
      d.textContent = t.label || 'DANCE FLOOR';
      floor.appendChild(d); return;
    }
    const table = document.createElement('div');
    table.className = 'table'; if (t.type==='square') table.classList.add('square');
    table.style.top = t.top+'px'; table.style.left = t.left+'px';
    table.dataset.id = t.id;
    const label = document.createElement('div'); label.className='table__label'; label.textContent=t.label||t.id;
    table.appendChild(label);

    if (t.seats) {
      for (let i=0;i<t.seats;i++) {
        const seat=document.createElement('div'); seat.className='seat'; seat.dataset.seatNumber=i+1;
        const key = seatKey(t.id,i+1);
        if (bookedFromSheet.includes(key)) seat.classList.add('booked');
        seat.addEventListener('click',e=>{
          e.stopPropagation();
          if (seat.classList.contains('booked')) return;
          const selectedSeats=[...table.querySelectorAll('.seat.selected')];
          if (!seat.classList.contains('selected') && selectedSeats.length>=2) { 
            alert('Max 2 seats per table'); return; 
          }
          seat.classList.toggle('selected');
        });
        table.appendChild(seat);
      }
    }
    table.addEventListener('click',()=>{ 
      if (t.type!=='rectangle') selectedTable=t.id;
      document.querySelectorAll('.table').forEach(tb=>tb.style.transform='scale(1)');
      table.style.transform='scale(1.12)';
    });
    floor.appendChild(table);
  });
}

// Init + polling
(async function initFloor() {
  const booked = await fetchBookedSeats();
  buildFloor(booked);
  setInterval(async () => {
    const latest = await fetchBookedSeats();
    markBookedSeats(latest);
  }, 5000);
})();

// ---------------- Confirmation ----------------
function showConfirmation() {
  const t=document.querySelector(`.table[data-id="${selectedTable}"]`);
  if (!t) return;
  const seats=[...t.querySelectorAll('.seat.selected')].map(s=>s.dataset.seatNumber);
  const f=document.getElementById('firstName').value.trim();
  const l=document.getElementById('lastName').value.trim();
  const c=document.getElementById('classSelect').value;
  const d=document.getElementById('dietary').value.trim();
  const m=document.getElementById('music').value.trim();
  document.getElementById('confirmation').innerHTML=`
    <p><strong>Name:</strong> ${f} ${l}</p>
    <p><strong>Class:</strong> ${c}</p>
    <p><strong>Table:</strong> ${selectedTable}</p>
    <p><strong>Seats:</strong> ${seats.join(', ')}</p>
    <p><strong>Dietary:</strong> ${d||'None'}</p>
    <p><strong>Music:</strong> ${m||'None'}</p>
    <p>Once submitted, seats will be permanently booked.</p>
  `;
}

// ---------------- Form Submission ----------------
document.getElementById('mdForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const submitBtn = e.target.querySelector('button[type="submit"]');
  submitBtn.disabled = true; submitBtn.textContent = 'Submitting‚Ä¶ ‚è≥';

  try {
    const f=document.getElementById('firstName').value.trim();
    const l=document.getElementById('lastName').value.trim();
    const c=document.getElementById('classSelect').value;
    const d=document.getElementById('dietary').value.trim();
    const m=document.getElementById('music').value.trim();
    const t=document.querySelector(`.table[data-id="${selectedTable}"]`);
    const seats=[...t.querySelectorAll('.seat.selected')].map(s=>s.dataset.seatNumber);

    if (!selectedTable || seats.length<1) {
      alert("Please select a table and at least one seat.");
      submitBtn.disabled=false; submitBtn.textContent='Submit'; return;
    }

    // File upload
    const fileInput=document.getElementById('paymentProof');
    let fileBase64='', fileName='', fileType='';
    if(fileInput.files.length>0){
      const file=fileInput.files[0];
      fileName=file.name; fileType=file.type;
      fileBase64=await new Promise((res,rej)=>{
        const r=new FileReader();
        r.onload=()=>res(r.result.split(',')[1]);
        r.onerror=e=>rej(e);
        r.readAsDataURL(file);
      });
    }

    const payload={ firstName:f, lastName:l, class:c, table:selectedTable,
      seats:seats.join(','), dietary:d, music:m, fileName, fileBase64, fileType };

    const response = await fetch(e.target.action, {
      method:'POST',
      body:new URLSearchParams({ payload: JSON.stringify(payload) })
    });
    const result=await response.json();

    if (!result.success) {
      alert("‚ùå " + result.message);
      submitBtn.disabled=false; submitBtn.textContent='Submit';
      const latest=await fetchBookedSeats();
      buildFloor(latest); return;
    }

    // Refresh seat map from server truth
    const latest=await fetchBookedSeats();
    buildFloor(latest);

    showStep(6); // thank you
  } catch (err) {
    alert('‚ùå Submission failed: ' + err.message);
    submitBtn.disabled=false; submitBtn.textContent='Submit';
  }
});
</script>

</body>
</html>



